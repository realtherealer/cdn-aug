window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),width=422,height=552;canvas.width=width,canvas.height=height;var player,animloop,menuloop,dir,platforms=[],image=document.getElementById("sprite"),platformCount=10,position=0,gravity=.2,flag=0,broken=0,score=0,firstRun=!0,Base=function(){this.height=5,this.width=width,this.cx=0,this.cy=614,this.cwidth=100,this.cheight=5,this.moved=0,this.x=0,this.y=height-this.height,this.draw=function(){try{ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(t){}}},base=new Base,Player=function(){this.vy=11,this.vx=0,this.isMovingLeft=!1,this.isMovingRight=!1,this.isDead=!1,this.width=55,this.height=40,this.cx=0,this.cy=0,this.cwidth=110,this.cheight=80,this.dir="left",this.x=width/2-this.width/2,this.y=height,this.draw=function(){try{"right"==this.dir?this.cy=121:"left"==this.dir?this.cy=201:"right_land"==this.dir?this.cy=289:"left_land"==this.dir&&(this.cy=371),ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(t){}},this.jump=function(){this.vy=-8},this.jumpHigh=function(){this.vy=-16}};function Platform(){this.width=70,this.height=17,this.x=Math.random()*(width-this.width),this.y=position,position+=height/platformCount,this.flag=0,this.state=0,this.cx=0,this.cy=0,this.cwidth=105,this.cheight=31,this.draw=function(){try{1==this.type?this.cy=0:2==this.type?this.cy=61:3==this.type&&0===this.flag?this.cy=31:3==this.type&&1==this.flag?this.cy=1e3:4==this.type&&0===this.state?this.cy=90:4==this.type&&1==this.state&&(this.cy=1e3),ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(t){}},this.types=score>=5e3?[2,3,3,3,4,4,4,4]:score>=2e3&&score<5e3?[2,2,2,3,3,3,3,4,4,4,4]:score>=1e3&&score<2e3?[2,2,2,3,3,3,3,3]:score>=500&&score<1e3?[1,1,1,1,1,2,2,2,2,3,3,3,3]:score>=100&&score<500?[1,1,1,1,2,2]:[1],this.type=this.types[Math.floor(Math.random()*this.types.length)],3==this.type&&broken<1?broken++:3==this.type&&broken>=1&&(this.type=1,broken=0),this.moved=0,this.vx=1}player=new Player;for(var i=0;i<platformCount;i++)platforms.push(new Platform);var Platform_broken_substitute=function(){this.height=30,this.width=70,this.x=0,this.y=0,this.cx=0,this.cy=554,this.cwidth=105,this.cheight=60,this.appearance=!1,this.draw=function(){try{if(!0!==this.appearance)return;ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(t){}}},platform_broken_substitute=new Platform_broken_substitute,spring=function(){this.x=0,this.y=0,this.width=26,this.height=30,this.cx=0,this.cy=0,this.cwidth=45,this.cheight=53,this.state=0,this.draw=function(){try{0===this.state?this.cy=445:1==this.state&&(this.cy=501),ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(t){}}},Spring=new spring;function init(){var t="left",e=0;function i(){"left"==t?(player.dir="left",player.vy<-7&&player.vy>-15&&(player.dir="left_land")):"right"==t&&(player.dir="right",player.vy<-7&&player.vy>-15&&(player.dir="right_land")),document.onkeydown=function(e){var i=e.keyCode;37==i?(t="left",player.isMovingLeft=!0):39==i&&(t="right",player.isMovingRight=!0),32==i&&(!0===firstRun?init():reset())},document.onkeyup=function(e){var i=e.keyCode;37==i?(t="left",player.isMovingLeft=!1):39==i&&(t="right",player.isMovingRight=!1)},!0===player.isMovingLeft?(player.x+=player.vx,player.vx-=.15):(player.x+=player.vx,player.vx<0&&(player.vx+=.1)),!0===player.isMovingRight?(player.x+=player.vx,player.vx+=.15):(player.x+=player.vx,player.vx>0&&(player.vx-=.1)),player.vx>8?player.vx=8:player.vx<-8&&(player.vx=-8),player.y+player.height>base.y&&base.y<height&&player.jump(),base.y>height&&player.y+player.height>height&&"lol"!=player.isDead&&(player.isDead=!0),player.x>width?player.x=0-player.width:player.x<0-player.width&&(player.x=width),player.y>=height/2-player.height/2?(player.y+=player.vy,player.vy+=gravity):(platforms.forEach((function(t,e){player.vy<0&&(t.y-=player.vy),t.y>height&&(platforms[e]=new Platform,platforms[e].y=t.y-height)})),base.y-=player.vy,player.vy+=gravity,player.vy>=0&&(player.y+=player.vy,player.vy+=gravity),score++),function(){platforms.forEach((function(t,i){if(player.vy>0&&0===t.state&&player.x+15<t.x+t.width&&player.x+player.width-15>t.x&&player.y+player.height>t.y&&player.y+player.height<t.y+t.height){if(3==t.type&&0===t.flag)return t.flag=1,void(e=0);if(4==t.type&&0===t.state)player.jump(),t.state=1;else{if(1==t.flag)return;player.jump()}}}));var t=Spring;player.vy>0&&0===t.state&&player.x+15<t.x+t.width&&player.x+player.width-15>t.x&&player.y+player.height>t.y&&player.y+player.height<t.y+t.height&&(t.state=1,player.jumpHigh())}(),!0===player.isDead&&function(){if(platforms.forEach((function(t,e){t.y-=12})),player.y>height/2&&0===flag)player.y-=8,player.vy=0;else if(player.y<height/2)flag=1;else if(player.y+player.height>height){showGoMenu(),hideScore(),player.isDead="lol",document.getElementById("tweetBtn").href="http://twitter.com/share?url=http://is.gd/PnFFzu&text=I just scored "+score+" points in the HTML5 Doodle Jump game!&count=horiztonal&via=cssdeck&related=solitarydesigns",document.getElementById("fbBtn").href="http://facebook.com/sharer.php?s=100&p[url]=http://cssdeck.com/labs/html5-doodle-jump/8&p[title]=I just scored "+score+" points in the HTML5 Doodle Jump game!&p[summary]=Can you beat me in this awesome recreation of Doodle Jump created in HTML5?"}}()}function h(){var t,h,r;ctx.clearRect(0,0,width,height),t=platform_broken_substitute,platforms.forEach((function(i,h){2==i.type&&((i.x<0||i.x+i.width>width)&&(i.vx*=-1),i.x+=i.vx),1==i.flag&&!1===t.appearance&&0===e&&(t.x=i.x,t.y=i.y,t.appearance=!0,e++),i.draw()})),!0===t.appearance&&(t.draw(),t.y+=8),t.y>height&&(t.appearance=!1),h=Spring,1==(r=platforms[0]).type||2==r.type?(h.x=r.x+r.width/2-h.width/2,h.y=r.y-r.height-10,h.y>height/1.1&&(h.state=0),h.draw()):(h.x=0-h.width,h.y=0-h.height),i(),player.draw(),base.draw(),document.getElementById("score").innerHTML=score}firstRun=!1,menuLoop=function(){},(animloop=function(){h(),requestAnimFrame(animloop)})(),hideMenu(),showScore()}function reset(){hideGoMenu(),showScore(),player.isDead=!1,flag=0,position=0,score=0,base=new Base,player=new Player,Spring=new spring,platform_broken_substitute=new Platform_broken_substitute,platforms=[];for(var t=0;t<platformCount;t++)platforms.push(new Platform)}function hideMenu(){document.getElementById("mainMenu").style.zIndex=-1}function showGoMenu(){var t=document.getElementById("gameOverMenu");t.style.zIndex=1,t.style.visibility="visible",document.getElementById("go_score").innerHTML="You scored "+score+" points!"}function hideGoMenu(){var t=document.getElementById("gameOverMenu");t.style.zIndex=-1,t.style.visibility="hidden"}function showScore(){document.getElementById("scoreBoard").style.zIndex=1}function hideScore(){document.getElementById("scoreBoard").style.zIndex=-1}function playerJump(){player.y+=player.vy,player.vy+=gravity,player.vy>0&&player.x+15<260&&player.x+player.width-15>155&&player.y+player.height>475&&player.y+player.height<500&&player.jump(),"left"==dir?(player.dir="left",player.vy<-7&&player.vy>-15&&(player.dir="left_land")):"right"==dir&&(player.dir="right",player.vy<-7&&player.vy>-15&&(player.dir="right_land")),document.onkeydown=function(t){var e=t.keyCode;37==e?(dir="left",player.isMovingLeft=!0):39==e&&(dir="right",player.isMovingRight=!0),32==e&&(!0===firstRun?(init(),firstRun=!1):reset())},document.onkeyup=function(t){var e=t.keyCode;37==e?(dir="left",player.isMovingLeft=!1):39==e&&(dir="right",player.isMovingRight=!1)},!0===player.isMovingLeft?(player.x+=player.vx,player.vx-=.15):(player.x+=player.vx,player.vx<0&&(player.vx+=.1)),!0===player.isMovingRight?(player.x+=player.vx,player.vx+=.15):(player.x+=player.vx,player.vx>0&&(player.vx-=.1)),player.y+player.height>base.y&&base.y<height&&player.jump(),player.x>width?player.x=0-player.width:player.x<0-player.width&&(player.x=width),player.draw()}function update(){ctx.clearRect(0,0,width,height),playerJump()}menuLoop=function(){update(),requestAnimFrame(menuLoop)},menuLoop();